<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<style>
    :root {
        --accent: rgb(130, 132, 248);
        --bg: rgb(19, 19, 29);
        --line: rgb(33, 33, 42);
        --text-mute: rgb(100, 100, 110); 
    }
    * { box-sizing: border-box; }
    
    body { 
        background-color: var(--bg);
        background-image: radial-gradient(circle at 50% -10%, rgba(130, 132, 248, 0.12), transparent 60%);
        color: #FFFFFF; 
        font-family: 'Segoe UI', sans-serif; 
        margin: 0; padding: 0; height: 100vh; width: 100vw; overflow: hidden; 
        user-select: none; cursor: default; 
        display: flex; flex-direction: column;
        border: 1px solid var(--line);
        border-radius: 16px; 
    }

    .top-bar {
        display: flex; justify-content: flex-end; align-items: center;
        padding: 15px; gap: 8px;
        z-index: 100;
        height: 50px;
        flex-shrink: 0;
    }

    .control-btn {
        width: 24px; height: 24px; border-radius: 50%;
        background: rgba(255,255,255,0.05);
        color: #888; display: flex; align-items: center; justify-content: center;
        font-size: 12px; cursor: pointer; transition: 0.2s;
        font-family: sans-serif;
    }
    .control-btn:hover { background: rgba(255,255,255,0.15); color: #fff; }
    
    .settings-icon {
        width: 14px; height: 14px;
        filter: invert(60%) sepia(5%) saturate(0%) hue-rotate(0deg) brightness(90%) contrast(90%);
        transition: 0.2s;
    }
    .control-btn:hover .settings-icon {
        filter: invert(100%) brightness(200%);
        transform: rotate(45deg);
    }
    .control-btn.active .settings-icon {
        filter: invert(53%) sepia(48%) saturate(3065%) hue-rotate(210deg) brightness(101%) contrast(96%);
        transform: rotate(90deg);
    }

    .close-btn:hover { background: rgba(255, 50, 50, 0.25); color: #ff5555; }

    .content-wrapper {
        position: relative;
        flex: 1;
        width: 100%;
        overflow: hidden;
    }

    .page {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        display: flex; flex-direction: column; align-items: center;
        padding: 0 40px; text-align: center;
        opacity: 0; pointer-events: none;
        transform: translateX(20px);
        transition: 0.3s ease-in-out;
    }
    
    .page.active {
        opacity: 1; pointer-events: all;
        transform: translateX(0);
    }

    .logo-container { margin-bottom: 20px; margin-top: 10px; }
    
    .logo-img { 
        width: 115px; height: 115px; 
        filter: invert(53%) sepia(48%) saturate(3065%) hue-rotate(210deg) brightness(101%) contrast(96%) drop-shadow(0 0 20px rgba(130, 132, 248, 0.6));
        pointer-events: none;      
        -webkit-user-drag: none;   
        user-select: none;       
    }
    .version-title { font-size: 20px; font-weight: 700; color: #FFFFFF; margin-bottom: 15px; }
    .version-num { color: var(--accent); margin-left: 10px; }
    
    .desc { font-size: 13px; color: var(--text-mute); line-height: 1.6; margin-bottom: 50px; max-width: 320px; }

    .action-container { width: 100%; height: 50px; position: relative; }
    
    .launch-btn {
        width: 100%; height: 100%; background: var(--accent);
        border: none; border-radius: 12px; color: white; font-size: 16px; font-weight: 600;
        cursor: pointer; transition: 0.3s; box-shadow: 0 4px 20px rgba(130, 132, 248, 0.25);
    }
    .launch-btn:disabled {
        background: #333; cursor: not-allowed; color: #777; box-shadow: none;
    }
    .launch-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(130, 132, 248, 0.4); }
    .launch-btn:active:not(:disabled) { transform: scale(0.98); }
    .launch-btn.hidden { opacity: 0; pointer-events: none; transform: scale(0.9); }

    .loader-wrapper {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        display: flex; flex-direction: column; justify-content: center;
        opacity: 0; pointer-events: none; transition: 0.3s; transform: translateY(10px);
    }
    .loader-wrapper.active { opacity: 1; transform: translateY(0); }
    
    .loader-text { font-size: 14px; color: white; margin-bottom: 8px; font-weight: 700; }
    .loader-track { width: 100%; height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; overflow: hidden; }
    .loader-fill {
        height: 100%; width: 0%; background: var(--accent);
        border-radius: 3px; box-shadow: 0 0 10px var(--accent); transition: width 0.1s linear;
    }

    .settings-title {
        font-size: 18px; font-weight: 600; color: #fff; margin-bottom: 40px; margin-top: 10px;
        width: 100%; text-align: left; border-bottom: 1px solid var(--line); padding-bottom: 10px;
    }

    .slider-group { width: 100%; text-align: left; margin-bottom: 30px; }
    .slider-label { font-size: 13px; color: var(--text-mute); margin-bottom: 10px; display: flex; justify-content: space-between; }
    .ram-value { color: var(--accent); font-weight: bold; }

    input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; cursor: pointer; }
    input[type=range]:focus { outline: none; }
    input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; }
    input[type=range]::-webkit-slider-thumb {
        -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%;
        background: #fff; margin-top: -6px; box-shadow: 0 0 10px rgba(255,255,255,0.5); transition: 0.2s;
    }
    input[type=range]:hover::-webkit-slider-thumb { background: var(--accent); }

    .reinstall-btn {
        width: 100%; background: transparent; border: 1px solid rgba(255, 50, 50, 0.4);
        color: #ff5555; padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s;
    }
    .reinstall-btn:hover { background: rgba(255, 50, 50, 0.1); border-color: #ff5555; }
</style>
</head>
<body>
    <div class="top-bar">
        <div class="control-btn" onclick="minimizeApp()">&#8722;</div>
        <div class="control-btn" id="btn-settings" onclick="toggleSettings()">
            <img src="https://realeso.github.io/pandora-loader/settings.svg" class="settings-icon">
        </div>
        <div class="control-btn close-btn" onclick="closeApp()">&#10006;</div>
    </div>

    <div class="content-wrapper">
        <div class="page active" id="page-home">
            <div class="logo-container">
                <img src="https://realeso.github.io/pandora-loader/logo.svg" class="logo-img" alt="Logo" draggable="false">
            </div>

            <div class="version-title">
                Версия<span class="version-num" id="version-text">...</span>
            </div>

            <div class="desc">
                Pandora — приватный DLC-клиент для Minecraft. Превосходный Combat, плавный Movement и регулярные обновления.
            </div>

            <div class="action-container">
                <button class="launch-btn" id="btn-launch" disabled onclick="launchGame()">Проверка...</button>
                
                <div class="loader-wrapper" id="loader-ui">
                    <div class="loader-text" id="loader-status">0%</div>
                    <div class="loader-track">
                        <div class="loader-fill" id="progress-fill"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="page" id="page-settings">
            <div class="settings-title">Настройки</div>
            <div class="slider-group">
                <div class="slider-label">
                    <span>Выделение памяти (RAM)</span>
                    <span class="ram-value" id="ram-display">4096 MB</span>
                </div>
                <input type="range" id="ram-slider" min="1024" max="16384" step="512" value="4096" oninput="updateRam(this.value)">
            </div>
            
            <button class="reinstall-btn" onclick="reinstallApp()">Переустановить клиент</button>
        </div>
    </div>

    <script>
        let currentRam = 4096;
        let isReadyToLaunch = false;

        document.addEventListener("DOMContentLoaded", () => {
            const savedRam = localStorage.getItem("pandora_ram");
            if (savedRam) {
                currentRam = savedRam;
                document.getElementById('ram-slider').value = currentRam;
                document.getElementById('ram-display').innerText = currentRam + " MB";
            }
            
            if(window.chrome && window.chrome.webview) {
                window.chrome.webview.postMessage("app_ready");
                
                window.chrome.webvi
